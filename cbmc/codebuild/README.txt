This directory contains two cloudformation templates:

  cbmc-build.yaml defines a code build target that build cbmc for windows
  iot.yaml defines a code build pipeline that build cbmc for windows and builds
     freertos from the gitfarm ARG freertos repository.

################################################################

cbmc-build.yaml

INSTALLATION

Create the stack with

aws cloudformation create-stack --stack-name cbmc-windows-build --template-body file://cbmc-windows.yaml --capabilities CAPABILITY_NAMED_IAM

USE

Build cbmc with

aws codebuild start-build --project-name goto-cl-manual-build

The bucket s3://<account_number>-cbmc-build/cbmc will contain the
binaries goto-cc and cbmc.

################################################################

iot.yaml

INSTALLATION

If CBMC Batch is not yet set up in the target account in the us-west-2 region:
set up the CBMC Batch stack using template/cbmc.yaml from the CBMC-batch
repository:

aws --region us-west-2 cloudformation create-stack --stack-name rtos-batch --template-body file://cbmc.yaml  --capabilities CAPABILITY_NAMED_IAM

Generate an OAuth token at https://github.com/settings/tokens/new,
with permissions "repo" and "admin:repo_hook". With this token <VALUE>, run

aws cloudformation create-stack --stack-name freertos-build --template-body file://iot.yaml --capabilities CAPABILITY_NAMED_IAM --parameters ParameterKey=GitHubToken,ParameterValue=<VALUE> ParameterKey=NotificationAddress,ParameterValue=$USER@amazon.com

An metrics dashboard for the pipeline can be generated by deploying

https://serverlessrepo.aws.amazon.com/applications/arn:aws:serverlessrepo:us-east-1:923120264911:applications~pipeline-dashboard

USE

Build freertos

aws codebuild start-build --project-name freertos-goto-cl-build

The bucket s3://<account_number>-rtos-build-<region> will contain the results

NOTE: This pipeline will also build cbmc.  The codebuild target
goto-cl-manual-build defined by cbmc-build.yaml is a way to build cbmc
manually without also building FreeRTOS.
